<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Vuex基础使用 · Hexo</title><meta name="description" content="Vuex基础使用 - John Doe"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/zoey.github.io/favicon.png"><link rel="stylesheet" href="/zoey.github.io/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="http://yoursite.com/atom.xml" title="Hexo"><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/zoey.github.io/atom.xml" title="Hexo" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="/zoey.github.io/" class="logo-link"><img src="/zoey.github.io/favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/zoey.github.io/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/zoey.github.io/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="http://weibo.com/sunchongsheng" target="_blank" class="nav-list-link">WEIBO</a></li><li class="nav-list-item"><a href="https://github.com/pinggod" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/zoey.github.io/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">Vuex基础使用</h1><div class="post-info">Jul 6, 2019</div><div class="post-content"><blockquote>
<p>Copy自<a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener">Vuex官方文档</a></p>
</blockquote>
<p>Vuex是一个专门为Vue程序开发的<em>状态管理模式</em>。采用集中式存储来管理应用的所有组件的状态。</p>
<h3 id="State"><a href="#State" class="headerlink" title="State"></a>State</h3><h4 id="获取State的方式："><a href="#获取State的方式：" class="headerlink" title="获取State的方式："></a>获取State的方式：</h4><ol>
<li>通过根实例中注册的store选项：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$store.state.count</span><br></pre></td></tr></table></figure></li>
<li>mapState 辅助函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">import &#123; mapState &#125; from &#39;vuex&#39;</span><br><span class="line">computed: &#123;</span><br><span class="line">    ...mapState()  &#x2F;&#x2F; mapState函数返回的是一个对象。</span><br><span class="line">    or</span><br><span class="line">    ...mapState([&#39;aount&#39;])  &#x2F;&#x2F; 可以给mapState传一个数组，数组的项是你要取的值。</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Getter"><a href="#Getter" class="headerlink" title="Getter"></a>Getter</h3><p><em>就像计算属性一样，getter的返回值会根据它的依赖被缓存起来，且只有当它的依赖发生了改变时才会被重新计算。</em></p>
<h4 id="定义方法："><a href="#定义方法：" class="headerlink" title="定义方法："></a>定义方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">const store &#x3D; new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        todos: [</span><br><span class="line">            &#123;id:1, done: true&#125;,</span><br><span class="line">            &#123;id: 2, done: false&#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    getters: &#123;</span><br><span class="line">        &#x2F;&#x2F; Getter 接受state作为其第一个参数</span><br><span class="line">        doneTodos(state) &#123;</span><br><span class="line">            return state.todos.filter(todo &#x3D;&gt; todo.done)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; Getter 也可以接受其他getter 作为其第二个参数</span><br><span class="line">        doneTodosCount(state, getters) &#123;</span><br><span class="line">            return getters.doneTodos.length &#x2F;&#x2F; 这里会获取到上面那个定义的getter方法(doneTodos)</span><br><span class="line">        &#125;,</span><br><span class="line">        &#x2F;&#x2F; 通过让getter返回一个函数，来实现给getter传参。在对store里的数组进行查询时非常有用。</span><br><span class="line">        getTodoById(state) &#123;</span><br><span class="line">            return (id) &#x3D;&gt; state.todos.find(todo &#x3D;&gt; todo.id &#x3D;&#x3D;&#x3D; id) &#x2F;&#x2F; 这里会通过参数id，从todos列表中返回Id相同的数据</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="获取Getter的方式："><a href="#获取Getter的方式：" class="headerlink" title="获取Getter的方式："></a>获取Getter的方式：</h4><ol>
<li>通过属性访问<br><code>this.$store.getters.doneTodos</code><blockquote>
<p>getter在通过属性访问时是作为Vue的响应式系统的一部分缓存其中的。</p>
</blockquote>
</li>
<li>通过方法访问（传参方式）<br><code>this.$store.getters.getTodoById(2)</code><blockquote>
<p>getter在通过方法访问时，每次都会去进行调用，而 <em>不会缓存结果</em>。</p>
</blockquote>
</li>
<li>mapGetters 辅助函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapGetters&#125; from &#39;vuex;</span><br><span class="line">computed: &#123;</span><br><span class="line">    ...mapGetters([&#39;doneTodos&#39;]) &#x2F;&#x2F; 使用对象展开运算符将getter混入computed中</span><br><span class="line">    &#x2F;&#x2F; 如果想将一个getter属性另取一个名字，使用对象形式：</span><br><span class="line">    ...mapGetters(&#123;</span><br><span class="line">        doneTodosCount: &#39;doneTodos&#39; &#x2F;&#x2F; 把this.doneTodosCount映射为this.$store.getters.doneTodos</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="Mutation"><a href="#Mutation" class="headerlink" title="Mutation"></a>Mutation</h3><p>更改store中的状态的<em>唯一方法</em>是提交mutation。</p>
<h4 id="定义方法：-1"><a href="#定义方法：-1" class="headerlink" title="定义方法："></a>定义方法：</h4><p>可以给mutation定义很多方法，这些方法就是我们实际进行状态更改的地方，并且它会接受state作为第一个参数。<br>可以向mutation方法传入额外的参数，大多数情况下参数应该是一个对象，这样可以包含多个字段并且记录的mutation会更易读。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">const store &#x3D; new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;...&#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        increment(state, payload) &#123;</span><br><span class="line">            state.count +&#x3D; payload.mount  &#x2F;&#x2F; 直接修改state</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="使用方式："><a href="#使用方式：" class="headerlink" title="使用方式："></a>使用方式：</h4><p>可以在组件中使用 <code>this.$sotre.commit(&#39;xxx&#39;)</code> 提交mutation，或者使用<code>mapMutations</code>辅助函数将组件中的methods映射为<code>store.commit</code>调用。</p>
<ol>
<li>普通方法<br><code>this.$store.commit(&#39;increment&#39;, { amount: 10 })</code></li>
<li>对象风格的提交方式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">this.$store.commit(&#123;</span><br><span class="line">    type: &#39;increment&#39;,  &#x2F;&#x2F; 直接使用包含type属性的对象，其他属性为参数。</span><br><span class="line">    amount: 10</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>mapMutations 辅助函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapMutations&#125; from &#39;vuex&#39;]</span><br><span class="line">methods: &#123;</span><br><span class="line">    ...mapMutations([</span><br><span class="line">        &#39;increment&#39;,  &#x2F;&#x2F; 将 this.increment() 映射为 this.$store.commit(&#39;increment&#39;)</span><br><span class="line">        &#39;incrementBy&#39;  &#x2F;&#x2F; 将 this.incrementBy() 映射为 this.$store.commit(&#39;incrementBy&#39;)</span><br><span class="line">    ]),</span><br><span class="line">    ...mapMutations(&#123;</span><br><span class="line">        add: &#39;increment&#39;  &#x2F;&#x2F;将 this.add 映射为 this.$store.commit(&#39;increment&#39;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="规则："><a href="#规则：" class="headerlink" title="规则："></a>规则：</h4>既然Vuex的store中的状态是响应式的，那么当我们变更状态时，监视状态的Vue组件也会自动更新。<br>这也意味着Vuex中的mutation也需要与使用Vue一样遵守一些注意事项：</li>
<li>最好提前在你的store中初始化好所需属性；</li>
<li>当需要在对象上添加新属性时，应该：<ul>
<li>使用Vue.set(obj, ‘newProp’, 123)</li>
<li>用新对象替换老对象：state.obj = {…state.obj, newProp: 123}</li>
</ul>
</li>
<li>mutation必须是同步函数。</li>
</ol>
<h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><p>action与mutation，不同在于：</p>
<ul>
<li>action提交的是mutaion，而不是直接变更状态</li>
<li>action可以包含任意异步操作<h4 id="定义方法：-2"><a href="#定义方法：-2" class="headerlink" title="定义方法："></a>定义方法：</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">const store &#x3D; new Vuex.Store(&#123;</span><br><span class="line">    state: &#123;</span><br><span class="line">        count: 0</span><br><span class="line">    &#125;,</span><br><span class="line">    mutations: &#123;</span><br><span class="line">        increment(state) &#123;</span><br><span class="line">            state.count++</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    actions: &#123;</span><br><span class="line">        &#x2F;&#x2F; action的方法接受一个与store实例具有相同方法和属性的context对象，因此可以调用&#96;context.commit&#96;提交一个mutation。</span><br><span class="line">        increment(context) &#123;</span><br><span class="line">            context.commit(&#39;increment&#39;)</span><br><span class="line">        &#125;</span><br><span class="line">        or</span><br><span class="line">        &#x2F;&#x2F; 实践中，会使用解构来简化代码</span><br><span class="line">        increment(&#123;commit&#125;) &#123;</span><br><span class="line">            commit(&#39;increment&#39;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="使用方式：-1"><a href="#使用方式：-1" class="headerlink" title="使用方式："></a>使用方式：</h4></li>
</ul>
<ol>
<li>action通过store.dispatch方法触发：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">this.$store.dispatch(&#39;increment&#39;)</span><br></pre></td></tr></table></figure></li>
<li>传递参数方式<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">this.$store.dispatch(&#39;increment&#39;, &#123;</span><br><span class="line">    amount: 1</span><br><span class="line">&#125;)</span><br><span class="line">&#x2F;&#x2F; 以对象形式</span><br><span class="line">this.$store.dispatch(&#123;</span><br><span class="line">    type: &#39;increment&#39;,</span><br><span class="line">    amount: 10</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
<li>mapActions 辅助函数<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;mapActions&#125; from &#39;vuex&#39;</span><br><span class="line">methods: &#123;</span><br><span class="line">    ...mapActions([&#39;increment&#39;]),</span><br><span class="line">    ...mapActions(&#123;</span><br><span class="line">        add: &#39;increment&#39; &#x2F;&#x2F; 将 &#96;this.add()&#96; 映射为 &#96;this.$store.dispatch(&#39;increment&#39;)&#96;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ol>
<h3 id="项目中使用："><a href="#项目中使用：" class="headerlink" title="项目中使用："></a>项目中使用：</h3><p><a href="https://github.com/zoey-git/vuex-module" target="_blank" rel="noopener">Vuex在项目中简单模块拆分</a></p>
</div></article></div></main><footer><div class="paginator"><a href="/zoey.github.io/2019/07/06/Vue%E5%93%8D%E5%BA%94%E5%8E%9F%E7%90%86/" class="prev">PREV</a><a href="/zoey.github.io/2019/07/06/Vue%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7%E5%86%85%E5%B9%95/" class="next">NEXT</a></div><div class="copyright"><p>© 2015 - 2020 <a href="http://yoursite.com">John Doe</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>